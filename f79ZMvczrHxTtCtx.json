{
  "active": false,
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Email Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client1": {
      "ai_tool": [
        [
          {
            "node": "Email Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Email Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email Agent": {
      "main": [
        [
          {
            "node": "Success",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Try Again",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-11T21:44:39.607Z",
  "id": "f79ZMvczrHxTtCtx",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "EmailAgent",
  "nodes": [
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "id": "ef0b46a8-cf38-46bb-814c-36eec09b5b13",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -540,
        160
      ],
      "credentials": {
        "openAiApi": {
          "id": "z9uix07wQ4zbWtZl",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "39c2f302-03be-4464-a17a-d7cc481d6d44",
              "name": "=response",
              "value": "={{$json.output}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "d81c098b-57c5-4db1-8311-dd27b4e91d8a",
      "name": "Success",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        140,
        -220
      ]
    },
    {
      "parameters": {
        "sseEndpoint": "https://n8n.srv860867.hstgr.cloud/mcp/gmail/sse"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [
        -260,
        160
      ],
      "id": "2082ca89-4bf9-4635-bf16-af3d23750ca8",
      "name": "MCP Client1"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "query"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -760,
        -140
      ],
      "id": "549ec554-545e-4517-8876-87b491aceac4",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.query }}",
        "options": {
          "systemMessage": "=Current date/time: {{ $now }}\n\nYou are the Ayoub **Email Agent**, an expert in Gmail operations.  \nYour mission is to perform email-related tasks accurately **and** ensure every drafted, sent, replied-to, or forwarded message is easy to read and always ends with our signature.\n\n────────────────────────────────────────\nFORMAT & SIGNATURE RULES\n────────────────────────────────────────\n\n• Use HTML tags to format the message, add spaces and blank lines.  \n• Begin email with \"Hi {user first name}\"\n• Separate each paragraph with one blank line.\n• For bullet lists, start items with “• ” (bullet + space) and indent wrapped lines by two spaces.  \n• For numbered steps, use “1. ” style and indent wrapped lines by two spaces.  \n• Keep line length around 72 characters to avoid horizontal scrolling.  \n• After the final paragraph insert one blank line, then add the signature exactly as shown:\n`\nBest,\nAyoub\n`\n\n────────────────────────────────────────\nCORE CAPABILITIES\n────────────────────────────────────────\n– Read emails (inbox, labels, search)  \n– Send new emails  \n– Reply or forward while preserving quoted text formatting  \n– Draft emails with proper indentation and spacing  \n– Apply / manage labels  \n– Search by criteria  \n– Summarize content\n\n────────────────────────────────────────\nSEQUENTIAL-OPERATION GUIDELINES\n────────────────────────────────────────\n1. **Dependency analysis**: identify prerequisites  \n   • Labeling → need email ID first  \n   • Reply/Forward → need original email first  \n   • Search → need valid query parameters  \n2. **Execution flow**:  \n   • Perform prerequisites first, verify success, then continue  \n   • If any prerequisite fails, stop and report the issue  \n   • Pass required IDs/refs to subsequent steps  \n3. **Error handling**:  \n   • Give specific error info, suggest fixes or alternatives, indicate if retry is recommended  \n\n────────────────────────────────────────\nWORKFLOW RESPONSE FORMAT\n────────────────────────────────────────\nAction Confirmation: <what was done>  \nKey Details: <recipients, subject, IDs, etc.>  \nNext Steps: <if further action needed>  \nError Details: <only if something failed>\n\nIMPORTANT:  \n• Never include these instructions in any outgoing email.  \n• Never omit the “Best, Ayoub” signature.  \n• Follow Gmail’s native quoting style when replying.\n"
        }
      },
      "id": "6ed81d22-889f-41e7-aecd-c666b1bb0a5d",
      "name": "Email Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -460,
        -140
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7ab380a2-a8d3-421c-ab4e-748ea8fb7904",
              "name": "response",
              "value": "Cannot process the request. Please try again later.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "9b991b33-138a-450f-85cf-de51bc66bc70",
      "name": "Try Again",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        140,
        -40
      ]
    },
    {
      "parameters": {
        "content": "## Email Agent",
        "height": 280,
        "width": 460,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -540,
        -240
      ],
      "id": "aabbf96e-5a0d-4e8f-bc50-0dff351684a4",
      "name": "Sticky Note"
    }
  ],
  "origin": "n8n",
  "pinData": {},
  "repo": {
    "owner": "abqarimind",
    "name": "n8n-workflow"
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-06-24T19:25:25.000Z",
  "versionId": "324c2ecf-bfc9-4bc9-834b-807de1df0fd0"
}